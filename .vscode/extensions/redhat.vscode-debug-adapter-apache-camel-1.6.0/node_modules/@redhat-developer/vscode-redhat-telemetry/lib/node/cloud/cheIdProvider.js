"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CheIdProvider = void 0;
const vscode_1 = require("vscode");
const logger_1 = require("../../common/utils/logger");
let userId;
class CheIdProvider {
    constructor(delegate) {
        this.delegate = delegate;
    }
    ;
    async getRedHatUUID() {
        if (!userId) {
            userId = await this.loadRedHatUUID();
        }
        return userId;
    }
    async loadRedHatUUID() {
        try {
            logger_1.Logger.info('Reading user id from @eclipse-che.ext-plugin');
            const che = vscode_1.extensions.getExtension('@eclipse-che.ext-plugin');
            if (che) {
                logger_1.Logger.info('Found Che API');
                // grab user
                const user = await che.exports.user?.getCurrentUser();
                if (user.id) {
                    logger_1.Logger.info(`Found Che user id ${user.id}`);
                    return user.id;
                }
                logger_1.Logger.info('No Che user id');
            }
            else {
                logger_1.Logger.info('No @eclipse-che.ext-plugin');
            }
        }
        catch (error) {
            console.log('Failed to get user id from Che', error);
        }
        //fall back to generating a random UUID
        logger_1.Logger.info('fall back to generating a random UUID');
        return this.delegate.getRedHatUUID();
    }
}
exports.CheIdProvider = CheIdProvider;
//# sourceMappingURL=cheIdProvider.js.map